<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/537.36" version="28.1.1">
  <diagram name="第 1 页" id="-Inj5p2uARNX9tiPIpZW">
    <mxGraphModel dx="2422" dy="2068" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="4" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="2" target="3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2" value="node_exporter.go" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="110" y="-500" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="8" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="3" target="6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="11" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="3" target="10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="3" value="&lt;b&gt;import 导入&lt;/b&gt;&lt;div&gt;&lt;b&gt;collector目录&lt;/b&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="110" y="-430" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="5" value="&lt;b&gt;collector目录内各收集器注册&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;dashPattern=12 12;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="280" y="-470" width="790" height="100" as="geometry" />
        </mxCell>
        <mxCell id="9" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="6" target="7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="6" value="&lt;font&gt;collector/xxx.go:&lt;/font&gt;&lt;div&gt;&lt;font&gt;init()&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="294" y="-430" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="46" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="7" target="45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="7" value="&lt;div style=&quot;font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;font style=&quot;&quot;&gt;collector/collector.go&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;font style=&quot;&quot;&gt;registerCollector(...)&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="510" y="-435" width="210" height="50" as="geometry" />
        </mxCell>
        <mxCell id="14" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="10" target="13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="10" value="参数解析" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="110" y="-340" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="12" value="j进入main()" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;dashed=1;dashPattern=8 8;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="-40" y="-340" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="25" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="13" target="17" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="13" value="log输出&lt;div&gt;相关环境信息&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="110" y="-280" width="120" height="40" as="geometry" />
        </mxCell>
        <mxCell id="24" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="16" target="23" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="16" value="配置metrices的API端点" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="95" y="-110" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="22" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="17" target="16" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="27" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="17" target="18" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="28" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="17" target="21" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="29" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="17" target="20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="17" value="newHandler()&lt;div&gt;创建指标处理器&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="95" y="-190" width="150" height="40" as="geometry" />
        </mxCell>
        <mxCell id="18" value="根据传入的参数决定是否&lt;div&gt;导出exporter自身的指标&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="310" y="-250" width="150" height="40" as="geometry" />
        </mxCell>
        <mxCell id="20" value="handler.unfilterHandler= innerHandler" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="310" y="-110" width="230" height="30" as="geometry" />
        </mxCell>
        <mxCell id="39" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="21" target="35" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="40" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="21" target="36" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="41" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="21" target="37" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="42" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="21" target="38" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="21" value="innerHandler=handler.innerHandler()&lt;div&gt;初始化handler&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="310" y="-187.5" width="230" height="35" as="geometry" />
        </mxCell>
        <mxCell id="32" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="23" target="31" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="23" value="web.ListenAndServe(xxx)&lt;div&gt;启动http server&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="95" y="-50" width="150" height="40" as="geometry" />
        </mxCell>
        <mxCell id="34" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="30" target="23" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="90" y="-25" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="30" value="客户端请求metrices" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;strokeColor=default;dashed=1;dashPattern=8 8;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="-100" y="-45" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="61" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="31" target="58" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="62" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="31" target="59" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="63" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="31" target="60" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="66" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="31" target="64" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="31" value="ServeHTTP()" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="95" y="125" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="54" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="35" target="49" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="55" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="35" target="53" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="35" value="nc = collector.NewNodeCollector(...)&lt;div&gt;创建节点收集器实例&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="580" y="-285" width="230" height="35" as="geometry" />
        </mxCell>
        <mxCell id="36" value="&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; 首次初始化（filter为空）时:&lt;div&gt;1. &lt;b&gt;记录启用的收集器nc.Collectors，写进handler.enabledCollectors&lt;/b&gt;&lt;/div&gt;&lt;div&gt;2. &lt;b&gt;log按字母顺序输出收集器名称&lt;/b&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;align=left;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="580" y="-210" width="400" height="60" as="geometry" />
        </mxCell>
        <mxCell id="44" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="37" target="43" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="37" value="1. r = prometheus.NewRegistry() 创建prometheus注册表&lt;div&gt;2. r.Register(nc) 注册节点收集器&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;align=left;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="580" y="-130" width="410" height="40" as="geometry" />
        </mxCell>
        <mxCell id="38" value="构造http handler" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=middle;align=left;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="580" y="-55" width="230" height="40" as="geometry" />
        </mxCell>
        <mxCell id="79" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="43" target="78" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="43" value="&lt;font style=&quot;&quot;&gt;触发collector.go-NodeCollector.Describe()&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=middle;align=left;dashed=1;dashPattern=8 8;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="1050" y="-130" width="230" height="40" as="geometry" />
        </mxCell>
        <mxCell id="57" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="45" target="48" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="45" value="&lt;div&gt;&lt;span style=&quot;&quot;&gt;&lt;font&gt;collector/collector.go&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;font-family: &amp;quot;Droid Sans Mono&amp;quot;, &amp;quot;monospace&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;font&gt;factories&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;font-family: &amp;quot;Droid Sans Mono&amp;quot;, &amp;quot;monospace&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span&gt;&lt;font&gt;&lt;div style=&quot;line-height: 19px;&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;font&gt;collectorState&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fillColor=none;strokeColor=default;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="880" y="-441.87" width="180" height="63.75" as="geometry" />
        </mxCell>
        <mxCell id="47" value="&lt;b&gt;更新factories&lt;/b&gt;&lt;div&gt;&lt;b&gt;collectorState&lt;/b&gt;&lt;/div&gt;" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="750" y="-430" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="52" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="48" target="50" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="48" value="&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;font&gt;collector/collector.go&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-family: &amp;quot;Droid Sans Mono&amp;quot;, &amp;quot;monospace&amp;quot;, monospace; font-size: 14px; white-space: pre;&quot;&gt;initiatedCollectors&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fillColor=none;strokeColor=default;fontColor=#000000;labelBackgroundColor=none;align=center;" parent="1" vertex="1">
          <mxGeometry x="1150" y="-355.94" width="210" height="61.87" as="geometry" />
        </mxCell>
        <mxCell id="51" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="49" target="48" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1147" y="-325" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="49" value="initiatedCollectors有对应注册器实例" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="880" y="-285" width="230" height="35" as="geometry" />
        </mxCell>
        <mxCell id="50" value="&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;font&gt;collector/collector.go&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-family: &amp;quot;Droid Sans Mono&amp;quot;, &amp;quot;monospace&amp;quot;, monospace; font-size: 14px; line-height: 19px; white-space: pre;&quot;&gt;&lt;span&gt;&lt;font&gt;&lt;div style=&quot;line-height: 19px;&quot;&gt;&lt;span style=&quot;&quot;&gt;&lt;font style=&quot;&quot;&gt;&lt;div style=&quot;line-height: 19px;&quot;&gt;&lt;span style=&quot;&quot;&gt;NodeCollector.Collectors&lt;/span&gt;&lt;/div&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fillColor=none;strokeColor=default;fontColor=#000000;labelBackgroundColor=none;align=center;" parent="1" vertex="1">
          <mxGeometry x="1414" y="-350.46000000000004" width="240" height="50.93" as="geometry" />
        </mxCell>
        <mxCell id="53" value="initiatedCollectors无对应注册器实例" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="880" y="-340" width="230" height="35" as="geometry" />
        </mxCell>
        <mxCell id="56" style="edgeStyle=none;html=1;exitX=0.25;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="53" target="45" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="69" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="58" target="68" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="58" value="解析collect[]、exclude[]等过滤参数" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="310" width="270" height="30" as="geometry" />
        </mxCell>
        <mxCell id="59" value="1. 无过滤参数，直接转发请求并返回：&lt;div&gt;handler.unfilteredHandler.ServeHTTP(...)&lt;/div&gt;&lt;div&gt;return&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="310" y="50" width="230" height="50" as="geometry" />
        </mxCell>
        <mxCell id="60" value="&lt;span&gt;&lt;font&gt;2. collect[]、exclude[]同时不为空&lt;/font&gt;&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;&quot;&gt;&lt;b style=&quot;&quot;&gt;&lt;font&gt;不允许，返回400&lt;/font&gt;&lt;/b&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="310" y="120" width="230" height="40" as="geometry" />
        </mxCell>
        <mxCell id="64" value="基于collect[]、exclude[]&lt;div&gt;确认最终过滤内容filters&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="310" y="180" width="230" height="40" as="geometry" />
        </mxCell>
        <mxCell id="70" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="65" target="68" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="65" value="3. 基于filters创建动态handler：&lt;div&gt;filterHandler = handler.innerHandler(*filters)&lt;/div&gt;&lt;div&gt;filterdHandler.ServeHTTP(w,r)&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="310" y="240" width="270" height="80" as="geometry" />
        </mxCell>
        <mxCell id="67" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.004;entryY=0.613;entryDx=0;entryDy=0;entryPerimeter=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="31" target="65" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="76" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="68" target="71" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="68" value="&lt;font style=&quot;--darkreader-inline-color: var(--darkreader-text-ff0000, #ff1a1a);&quot; data-darkreader-inline-color=&quot;&quot;&gt;触发collector.go-NodeCollector.Collect()&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=middle;align=left;dashed=1;dashPattern=8 8;fontColor=#FF0000;labelBackgroundColor=none;strokeColor=#FF0000;" parent="1" vertex="1">
          <mxGeometry x="685" y="140" width="230" height="40" as="geometry" />
        </mxCell>
        <mxCell id="77" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="71" target="75" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="71" value="&lt;font style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;collector.go-NodeCollector.Collect()&lt;/font&gt;&lt;div&gt;并行运行所有子收集器NodeCollector.Collectors：&lt;/div&gt;&lt;div&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;1. 执行execute()&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=middle;align=left;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="971" y="140" width="270" height="40" as="geometry" />
        </mxCell>
        <mxCell id="75" value="&lt;font style=&quot;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;collector.go-execute()&lt;/font&gt;&lt;div&gt;&lt;font style=&quot;&quot;&gt;1. 记录开始时间&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;&quot;&gt;2. 执行对应收集器的&lt;/font&gt;&lt;font style=&quot;&quot;&gt;&lt;b&gt;Update()&lt;/b&gt;&lt;/font&gt;&lt;font style=&quot;&quot;&gt;获取指标&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;&quot;&gt;3. 计算耗时获得scrapeDuration 指标&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;&quot;&gt;4. 根据执行结果计算 scrapeSuccess指标&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;&quot;&gt;5. 将所有指标发送到ch&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;font style=&quot;&quot;&gt;6. 记录错误日志（若有）&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=middle;align=left;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="971" y="240" width="270" height="120" as="geometry" />
        </mxCell>
        <mxCell id="78" value="ch &amp;lt;- scrapeDurationDesc;&lt;div&gt;ch &amp;lt;- scrapeSuccessDesc;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=middle;align=center;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="1050" y="-45" width="230" height="40" as="geometry" />
        </mxCell>
        <mxCell id="80" value="&lt;div style=&quot;&quot;&gt;&lt;font data-darkreader-inline-color=&quot;&quot; style=&quot;--darkreader-inline-color: var(--darkreader-text-ff0000, #ff1a1a); color: rgb(255, 0, 0);&quot;&gt;1. &lt;font&gt;factories中存储&lt;/font&gt;&lt;b style=&quot;&quot;&gt;各个收集器注册的工厂函数&lt;/b&gt;，通过调用对应工厂函数，&lt;b style=&quot;&quot;&gt;可创建对应得收集器实例&lt;/b&gt;；&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;font data-darkreader-inline-color=&quot;&quot; style=&quot;--darkreader-inline-color: var(--darkreader-text-ff0000, #ff1a1a); color: rgb(255, 0, 0);&quot;&gt;2.&amp;nbsp;&lt;span style=&quot;font-family: &amp;quot;Droid Sans Mono&amp;quot;, &amp;quot;monospace&amp;quot;, monospace; font-size: 14px; text-align: center; white-space: pre;&quot;&gt;&lt;font&gt;collectorState&lt;/font&gt;存储对应收集器的状态，&lt;/span&gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;&quot;&gt;&lt;span style=&quot;font-family: &amp;quot;Droid Sans Mono&amp;quot;, &amp;quot;monospace&amp;quot;, monospace; font-size: 14px; text-align: center; white-space: pre;&quot;&gt;&lt;font data-darkreader-inline-color=&quot;&quot; style=&quot;--darkreader-inline-color: var(--darkreader-text-ff0000, #ff1a1a); color: rgb(255, 0, 0);&quot;&gt;如enable获disable&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fillColor=none;strokeColor=#FF0000;fontColor=#000000;labelBackgroundColor=none;align=left;dashed=1;dashPattern=8 8;" parent="1" vertex="1">
          <mxGeometry x="1090" y="-551.87" width="310" height="81.87" as="geometry" />
        </mxCell>
        <mxCell id="84" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="82" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="170" y="585" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="82" value="arp_linux.go-Update()" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="95" y="500" width="150" height="30" as="geometry" />
        </mxCell>
        <mxCell id="89" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="85" target="88" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="92" style="edgeStyle=none;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="85" target="91" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="369" y="625" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="85" value="arpNetlink&lt;div&gt;为真？&lt;/div&gt;" style="rhombus;whiteSpace=wrap;html=1;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="100" y="585" width="140" height="80" as="geometry" />
        </mxCell>
        <mxCell id="97" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="88" target="96" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="88" value="getTotalArpEntriesRTNL()&lt;div&gt;统计各设备的arp数量&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="95" y="710" width="150" height="40" as="geometry" />
        </mxCell>
        <mxCell id="90" value="是" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="160" y="668" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="95" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="91" target="94" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="91" value="c.fs.GatherARPEntries()&lt;div&gt;读取/proc/net/arp内容&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="294" y="710" width="150" height="40" as="geometry" />
        </mxCell>
        <mxCell id="93" value="否" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="294" y="600" width="40" height="30" as="geometry" />
        </mxCell>
        <mxCell id="99" style="edgeStyle=none;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontColor=#000000;labelBackgroundColor=none;" parent="1" source="94" target="96" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="369" y="870" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="94" value="getTotalArpEntries()&lt;div&gt;统计各设备的arp数量&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="294" y="780" width="150" height="40" as="geometry" />
        </mxCell>
        <mxCell id="96" value="为每个条目创建prometheus指标&lt;div&gt;（跳过不在deviceFilter的设备）&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;verticalAlign=top;fontColor=#000000;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="80" y="850" width="180" height="40" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
